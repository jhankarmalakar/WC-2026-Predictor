<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>World Cup 2026 – Pools → Form Groups → Group Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#0f1220;
      --panel:#151a2e;
      --panel-2:#111527;
      --text:#f5f7ff;
      --muted:#b9c0e6;
      --accent:#7aa2ff;
      --border:rgba(255,255,255,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 14px;

      /* Rank highlights */
      --hl-strong-bg: rgba(94, 230, 168, 0.14);
      --hl-strong-br: rgba(94, 230, 168, 0.45);
      --hl-mild-bg:   rgba(122, 162, 255, 0.10);
      --hl-mild-br:   rgba(122, 162, 255, 0.35);

      /* Qualified styling */
      --qualified-br: rgba(94, 230, 168, 0.55);
      --qualified-glow: rgba(94, 230, 168, 0.18);

      /* Eliminated styling */
      --elim-bg: rgba(255, 107, 122, 0.08);
      --elim-br: rgba(255, 107, 122, 0.35);

      /* Click-swap armed styling (amber) */
      --swap-bg: rgba(255, 184, 107, 0.14);
      --swap-br: rgba(255, 184, 107, 0.55);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 10% 10%, #1c2342 0%, var(--bg) 40%, #070912 100%);
      min-height:100vh;
    }

    header{
      padding: 18px 20px 8px 20px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap: wrap;
    }
    header h1{
      font-size: 18px;
      font-weight: 650;
      margin:0 0 2px 0;
    }
    header .hint{
      color:var(--muted);
      font-size: 11.5px;
      max-width: 70ch;
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap: wrap;
    }

    .stage-pill{
      font-size: 11.5px;
      color: var(--text);
      border: 1px solid var(--border);
      padding: 9px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      letter-spacing: 0.2px;
    }

    button{
      background: rgba(122,162,255,0.12);
      color: var(--text);
      border: 1px solid rgba(122,162,255,0.35);
      padding: 11px 14px;
      border-radius: 12px;
      font-size: 12.5px;
      cursor: pointer;
      white-space: nowrap;
    }
    button:hover{ background: rgba(122,162,255,0.18); }
    button:disabled{ opacity: 0.6; cursor: not-allowed; }

    /* Board grid */
    .board{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      padding: 8px 16px 30px 16px;
    }
    @media (min-width: 780px){
      .board{ grid-template-columns: 1fr 1fr; }
    }
    @media (min-width: 1100px){
      .board{ grid-template-columns: 1fr 1fr 1fr; }
    }
    @media (min-width: 1400px){
      .board{ grid-template-columns: 1fr 1fr 1fr 1fr; }
    }

    /* Stage separators */
    .stage-separator{
      grid-column: 1 / -1;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 6px 2px 6px;
    }
    .stage-left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
      flex: 1;
    }
    .stage-title{
      font-size: 11px;
      letter-spacing: 0.35px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.55);
      white-space: nowrap;
    }
    .stage-line{
      height: 1px;
      background: var(--border);
      flex: 1;
      min-width: 30px;
    }

    /* Column */
    .column{
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: 160px;
      display:flex;
      flex-direction:column;
    }
    .column-header{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--border);
      gap: 10px;
    }
    .column-title{
      font-size: 12.2px;
      letter-spacing: 0.35px;
      text-transform: uppercase;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 80%;
    }
    .count{
      font-size: 10.5px;
      color: var(--muted);
      opacity: 0.9;
      white-space: nowrap;
    }

    .zone{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      flex: 1;
    }

    /* Card */
    .card{
      background: rgba(255,255,255,0.04);
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      user-select: none;
      cursor: pointer;
      transition: background 120ms ease, border-color 120ms ease, box-shadow 120ms ease;
    }
    .card.locked{
      cursor: default;
      opacity: 0.9;
    }

    .name{
      font-size: 13.8px;
      font-weight: 560;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .tag{
      font-size: 9.8px;
      color: var(--muted);
      border:1px solid var(--border);
      padding: 3px 7px;
      border-radius: 999px;
      white-space: nowrap;
    }

    /* Rank highlights */
    .rank-strong{
      background: var(--hl-strong-bg);
      border-color: var(--hl-strong-br);
    }
    .rank-mild{
      background: var(--hl-mild-bg);
      border-color: var(--hl-mild-br);
    }

    /* Qualified/Eliminated */
    .qualified{
      border-color: var(--qualified-br);
      box-shadow: 0 0 0 1px var(--qualified-glow) inset;
    }
    .eliminated{
      background: var(--elim-bg);
      border-color: var(--elim-br);
    }

    /* First-click armed swap */
    .swap-armed{
      background: var(--swap-bg);
      border-color: var(--swap-br);
      box-shadow: 0 0 0 1px rgba(255,184,107,0.18) inset;
    }

    .footer{
      padding: 0 16px 24px 16px;
      color: var(--muted);
      font-size: 11px;
    }
  </style>
</head>

<body>
  <header>
    <div>
      <h1>Qualifier Pools → Form Groups → Tools</h1>
      <div class="hint">
        Click/tap two teams in the same editable zone to swap. Use “Form Groups” to copy current pool winners into groups.
        Use “Reform Pool” to unlock pools and lock groups (without changing group order).
      </div>
    </div>

    <div class="actions">
      <span class="stage-pill" id="stagePill">Edit: Pools</span>
      <button id="reformPoolBtn" disabled>Reform Pool</button>
      <button id="resetBtn">Reset</button>
    </div>
  </header>

  <main class="board" id="board"></main>

  <div class="footer">
    No drag. Pools editable only in Pool mode. Groups + Third-place ranking editable only in Group mode.
  </div>

  <script>
    /* ==============================
       1) GROUPS + PATHS
    ============================== */
    const DEFAULT_GROUPS = {
      A: ["Mexico","South Africa","South Korea","UFEA Path D"],
      B: ["Canada","UFEA Path A","Qatar","Switzerland"],
      C: ["Brazil","Morocco","Haiti","Scotland"],
      D: ["United States","Paraguay","Australia","UFEA Path C"],
      E: ["Germany","Curaçao","Ivory Coast","Ecuador"],
      F: ["Netherlands","Japan","UFEA Path B","Tunisia"],
      G: ["Belgium","Egypt","Iran","New Zealand"],
      H: ["Spain","Cape Verde","Saudi Arabia","Uruguay"],
      I: ["France","Senegal","FIFA IC Path 2","Norway"],
      J: ["Argentina","Algeria","Austria","Jordan"],
      K: ["Portugal","FIFA IC Path 1","Uzbekistan","Colombia"],
      L: ["England","Croatia","Ghana","Panama"]
    };

    const PATHS = [
      { id: "ufeapath-a", label: "UFEA Path A",
        candidates: ["Wales", "Bosnia and Herzegovina", "Italy", "Northern Ireland"], group: "B" },
      { id: "ufeapath-b", label: "UFEA Path B",
        candidates: ["Ukraine", "Sweden", "Poland", "Albania"], group: "F" },
      { id: "ufeapath-c", label: "UFEA Path C",
        candidates: ["Slovakia", "Kosovo", "Turkey", "Romania"], group: "D" },
      { id: "ufeapath-d", label: "UFEA Path D",
        candidates: ["Czech Republic", "Republic of Ireland", "Denmark", "North Macedonia"], group: "A" },
      { id: "fifaicpath-1", label: "FIFA IC Path 1",
        candidates: ["New Caledonia", "Jamaica", "DR Congo"], group: "K" },
      { id: "fifaicpath-2", label: "FIFA IC Path 2",
        candidates: ["Bolivia", "Suriname", "Iraq"], group: "I" }
    ];

    const PATH_BY_ID = Object.fromEntries(PATHS.map(p => [p.id, p]));
    const PATH_ID_BY_LABEL = Object.fromEntries(PATHS.map(p => [p.label, p.id]));
    const GROUP_KEYS = Object.keys(DEFAULT_GROUPS);

    const toId = (name) =>
      name.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");

    /* ==============================
       2) Edit mode + click-swap state
       editMode:
         - "pools": pools editable, groups locked
         - "groups": groups + third-ranking editable, pools locked
    ============================== */
    let editMode = "pools";
    let swapSelection = null; // { teamId, zone }

    /* ==============================
       3) State
    ============================== */
    function buildGroupsFromDefaults(){
      const groups = {};
      GROUP_KEYS.forEach(g => {
        groups[g] = DEFAULT_GROUPS[g].map(entryName => {
          const pathId = PATH_ID_BY_LABEL[entryName];
          if(pathId){
            return {
              id: `ph-${pathId}-${g}`,
              name: entryName,
              tag: "Placeholder",
              isPlaceholder: true,
              pathId
            };
          }
          return {
            id: toId(`${g}-${entryName}`),
            name: entryName,
            tag: `Group ${g}`,
            isPlaceholder: false
          };
        });
      });
      return groups;
    }

    function buildPaths(){
      const paths = {};
      PATHS.forEach(p => {
        paths[p.id] = p.candidates.map(name => ({
          id: toId(`${p.id}-${name}`),
          name,
          tag: p.label,
          originPathId: p.id,
          isQualified: false,
          isEliminated: false
        }));
      });
      return paths;
    }

    function buildThirdRankingFromGroups(groups){
      const base = [];
      GROUP_KEYS.forEach(g => {
        const third = groups[g]?.[2];
        base.push({
          id: toId(`third-${g}-${third?.name ?? "tbd"}`),
          groupKey: g,
          name: third?.name ?? "TBD"
        });
      });
      return base;
    }

    const initialState = () => {
      const groups = buildGroupsFromDefaults();
      const paths  = buildPaths();
      const qualifiedByPath = {};
      PATHS.forEach(p => qualifiedByPath[p.id] = false);

      return {
        paths,
        groups,
        qualifiedByPath,
        thirdRanking: buildThirdRankingFromGroups(groups)
      };
    };

    let state = initialState();

    /* ==============================
       4) Zones
    ============================== */
    const pathZones  = PATHS.map(p => `path-${p.id}`);
    const groupZones = GROUP_KEYS.map(g => `group-${g}`);

    const THIRD_RANK_ZONE = "third-ranking";
    const CHAMP_ZONE      = "champions-view";
    const RUNNERS_ZONE    = "runners-view";
    const TOP8_ZONE       = "top8-third-view";

    const zones = [
      ...pathZones,
      ...groupZones,
      THIRD_RANK_ZONE, CHAMP_ZONE, RUNNERS_ZONE, TOP8_ZONE
    ];

    const isPathZone = (z) => z.startsWith("path-");
    const isGroupZone = (z) => z.startsWith("group-");
    const isDerivedZone = (z) =>
      [THIRD_RANK_ZONE, CHAMP_ZONE, RUNNERS_ZONE, TOP8_ZONE].includes(z);

    const pathIdFromZone = (z) => z.replace("path-","");
    const groupKeyFromZone = (z) => {
      const m = z.match(/^group-([A-L])$/);
      return m ? m[1] : null;
    };

    /* ==============================
       5) UI build
    ============================== */
    function makeSeparator(text, withButton=false){
      const sep = document.createElement("div");
      sep.className = "stage-separator";

      const left = document.createElement("div");
      left.className = "stage-left";
      left.innerHTML = `
        <span class="stage-title">${text}</span>
        <span class="stage-line"></span>
      `;
      sep.appendChild(left);

      if(withButton){
        const btn = document.createElement("button");
        btn.id = "formGroupsBtn";
        btn.textContent = "Form Groups";
        sep.appendChild(btn);
      }
      return sep;
    }

    function makeColumn(title, zoneKey, subtitle = ""){
      const col = document.createElement("section");
      col.className = "column";
      col.innerHTML = `
        <div class="column-header">
          <div class="column-title">${title}${subtitle ? ` • ${subtitle}` : ""}</div>
          <div class="count" data-count-for="${zoneKey}"></div>
        </div>
        <div class="zone" data-zone="${zoneKey}"></div>
      `;
      return col;
    }

    function buildBoard(){
      const board = document.getElementById("board");
      board.innerHTML = "";

      // Pools
      board.appendChild(makeSeparator("Qualifier Pools (click-swap in Pool mode)"));
      PATHS.forEach(p => {
        board.appendChild(makeColumn(p.label, `path-${p.id}`, `feeds Group ${p.group}`));
      });

      // Groups
      board.appendChild(makeSeparator("Groups (click-swap in Group mode)", true));
      GROUP_KEYS.forEach(g => {
        board.appendChild(makeColumn(`Group ${g}`, `group-${g}`));
      });

      // Tools / tables
      board.appendChild(makeSeparator("Group Tools & Third-Place Logic"));
      board.appendChild(makeColumn("Third Place Team Ranking", THIRD_RANK_ZONE, "A3 → L3"));
      board.appendChild(makeColumn("Group Champions", CHAMP_ZONE, "A1 → L1"));
      board.appendChild(makeColumn("Group Runners", RUNNERS_ZONE, "A2 → L2"));
      board.appendChild(makeColumn("Top-8 Third Placed Teams", TOP8_ZONE, "auto"));
    }

    /* ==============================
       6) Edit rules
    ============================== */
    function isClickSwapEnabledForZone(zoneKey){
      if(editMode === "pools"){
        return isPathZone(zoneKey);
      }
      if(editMode === "groups"){
        return isGroupZone(zoneKey) || zoneKey === THIRD_RANK_ZONE;
      }
      return false;
    }

    /* ==============================
       7) Derived data
    ============================== */
    function getThirdTeamForGroup(g){
      const arr = state.groups[g] ?? [];
      const t = arr[2];
      return t && !t.isPlaceholder ? t : null;
    }

    function syncThirdRankingNames(){
      // Ensure one entry per groupKey, preserve user order
      const existingByGroup = new Map(state.thirdRanking.map(x => [x.groupKey, x]));

      // Add missing groups
      GROUP_KEYS.forEach(g => {
        if(!existingByGroup.has(g)){
          state.thirdRanking.push({
            id: toId(`third-${g}-tbd`),
            groupKey: g,
            name: "TBD"
          });
        }
      });

      // Remove extras that no longer map to a group (unlikely)
      state.thirdRanking = state.thirdRanking.filter(x => GROUP_KEYS.includes(x.groupKey));

      // Update names based on current group 3rd-place
      state.thirdRanking.forEach(item => {
        const third = getThirdTeamForGroup(item.groupKey);
        item.name = third ? third.name : "TBD";
      });
    }

    function computeChampions(){
      return GROUP_KEYS.map(g => {
        const t = state.groups[g]?.[0];
        return {
          id: toId(`champ-${g}-${t?.name ?? "tbd"}`),
          name: t?.name ?? "TBD",
          groupKey: g
        };
      });
    }

    function computeRunners(){
      return GROUP_KEYS.map(g => {
        const t = state.groups[g]?.[1];
        return {
          id: toId(`runner-${g}-${t?.name ?? "tbd"}`),
          name: t?.name ?? "TBD",
          groupKey: g
        };
      });
    }

    function computeTop8ThirdPlaced(){
      syncThirdRankingNames();
      return state.thirdRanking.slice(0, 8).map((x, i) => ({
        id: toId(`top8-third-${i}-${x.groupKey}-${x.name}`),
        name: x.name,
        groupKey: x.groupKey
      }));
    }

    /* ==============================
       8) Zone arrays
    ============================== */
    function getZoneArray(zoneKey){
      if(isPathZone(zoneKey)){
        return state.paths[pathIdFromZone(zoneKey)];
      }
      if(isGroupZone(zoneKey)){
        return state.groups[groupKeyFromZone(zoneKey)];
      }
      if(zoneKey === THIRD_RANK_ZONE){
        syncThirdRankingNames();
        return state.thirdRanking;
      }
      if(zoneKey === CHAMP_ZONE){
        return computeChampions();
      }
      if(zoneKey === RUNNERS_ZONE){
        return computeRunners();
      }
      if(zoneKey === TOP8_ZONE){
        return computeTop8ThirdPlaced();
      }
      return null;
    }

    /* ==============================
       9) Pool status display
    ============================== */
    function clearPoolStatus(){
      PATHS.forEach(p => {
        const arr = state.paths[p.id];
        if(!arr) return;
        arr.forEach(t => {
          t.isQualified = false;
          t.isEliminated = false;
        });
        state.qualifiedByPath[p.id] = false;
      });
    }

    function markQualifiedAndEliminated(pathId){
      const pathArr = state.paths[pathId];
      if(!pathArr || pathArr.length === 0) return;

      pathArr.forEach((t, i) => {
        t.isQualified = (i === 0);
        t.isEliminated = (i !== 0);
      });
      state.qualifiedByPath[pathId] = true;
    }

    /* ==============================
       10) Render
    ============================== */
    function render(){
      // Keep third-ranking synced with group A3..L3
      syncThirdRankingNames();

      zones.forEach(zone => {
        const dz = document.querySelector(`.zone[data-zone="${zone}"]`);
        if(!dz) return;

        dz.innerHTML = "";
        const arr = getZoneArray(zone) ?? [];
        const gKey = isGroupZone(zone) ? groupKeyFromZone(zone) : null;

        arr.fo
