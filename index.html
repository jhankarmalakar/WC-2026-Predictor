<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WC 2026 R32 Predictor</title>

  <style>
    :root{
      --bg:#ffffff;
      --panel:#f8f9fa;
      --border:#a2a9b1;
      --text:#202122;
      --muted:#54595d;
      --accent:#0645ad;
      --ok:#0b6b2f;
      --warn:#b54708;
    }

    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: var(--bg);
      margin: 0;
      padding: 24px;
    }

    .container{
      max-width: 1100px;
      margin: 0 auto;
    }

    h1{
      font-size: 28px;
      margin: 0 0 8px 0;
    }
    .subtitle{
      color: var(--muted);
      margin-bottom: 18px;
    }

    .grid{
      display: grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 18px;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border: 1px solid var(--border);
      background: var(--panel);
      padding: 14px 14px 10px 14px;
      border-radius: 8px;
    }

    .card h2{
      font-size: 18px;
      margin: 0 0 10px 0;
    }

    /* Wikipedia-ish table look */
    table.wikitable{
      border-collapse: collapse;
      border: 1px solid var(--border);
      background: #fff;
      width: 100%;
      font-size: 14px;
    }
    .wikitable caption{
      caption-side: top;
      text-align: left;
      font-weight: 600;
      padding: 6px 2px 10px 2px;
    }
    .wikitable th,
    .wikitable td{
      border: 1px solid var(--border);
      padding: 6px 8px;
      vertical-align: middle;
    }
    .wikitable th{
      background: #eaecf0;
      font-weight: 600;
    }

    .group-table th:nth-child(1){ width: 80px; }
    .group-table th:nth-child(2),
    .group-table th:nth-child(3),
    .group-table th:nth-child(4){ width: 26%; }
    .group-table th:nth-child(5){ width: 140px; text-align: center; }

    input.team{
      width: 100%;
      box-sizing: border-box;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 8px;
      background: #fff;
      font-size: 13.5px;
    }
    input.team::placeholder{ color: #8a8f94; }

    .third-toggle{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 12.5px;
      color: var(--muted);
    }

    .controls{
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    button{
      border: 1px solid var(--border);
      background: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13.5px;
    }
    button.primary{
      background: #eaf2ff;
      border-color: #9bb7f0;
      color: #0b2e78;
    }

    .status{
      margin-top: 8px;
      font-size: 12.5px;
      color: var(--muted);
    }
    .status .ok{ color: var(--ok); font-weight: 600; }
    .status .warn{ color: var(--warn); font-weight: 600; }

    .small{
      font-size: 11.5px;
      color: var(--muted);
    }

    .pill{
      display: inline-block;
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      color: var(--muted);
      margin-left: 6px;
    }

    details{
      margin-top: 10px;
    }
    summary{
      cursor: pointer;
      color: var(--accent);
      font-size: 12.5px;
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11.5px;
      background: #fff;
      border: 1px solid var(--border);
      padding: 8px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WC 2026 Round of 32 Predictor</h1>
    <div class="subtitle">
      Enter group finishers and select the 8 third-placed groups that advance. The third-place opponent mapping
      is loaded automatically from <span class="mono" style="padding:2px 6px;">third-mapping.json</span>. :contentReference[oaicite:0]{index=0}
    </div>

    <div class="grid">
      <!-- LEFT: Group Inputs -->
      <div class="card">
        <h2>Group Inputs</h2>
        <table class="wikitable group-table" id="groupTable">
          <thead>
            <tr>
              <th>Group</th>
              <th>1st</th>
              <th>2nd</th>
              <th>3rd</th>
              <th>3rd Advances?</th>
            </tr>
          </thead>
          <tbody>
            <!-- injected by JS -->
          </tbody>
        </table>

        <div class="controls">
          <button class="primary" id="generateBtn">Generate R32</button>
          <button id="clearBtn">Clear Inputs</button>
          <button id="demoBtn">Fill Demo Names</button>
        </div>

        <div class="status" id="statusLine">
          Loading third-place mapping…
        </div>

        <details>
          <summary>Advanced: Edit fixed R32 pairings in code</summary>
          <div class="small" style="margin:8px 0 6px 0;">
            This page assumes 8 group winners face third-placed teams based on your mapping table.
            The remaining R32 games are defined in <span class="mono" style="padding:2px 6px;">FIXED_MATCH_SLOTS</span>.
            If your repo already had a correct list, paste it there.
          </div>
        </details>
      </div>

      <!-- RIGHT: Output -->
      <div class="card">
        <h2>Round of 32</h2>
        <table class="wikitable" id="r32Table">
          <caption>Knockout stage — Round of 32</caption>
          <thead>
            <tr>
              <th style="width: 90px;">Match</th>
              <th>Home</th>
              <th>Away</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="3" class="small">
                Generate to see matchups.
              </td>
            </tr>
          </tbody>
        </table>

        <details>
          <summary>Show mapping key used</summary>
          <div class="mono" id="mappingDebug">—</div>
        </details>
      </div>
    </div>
  </div>

  <script type="module">
    // -----------------------------
    // CONFIG
    // -----------------------------

    const GROUPS = "ABCDEFGHIJKL".split("");

    // These 8 winners are the ones that will face a third-placed team
    // according to your big Wikipedia-style mapping table header.
    const THIRD_WINNERS_ORDER = ["A","B","D","E","G","I","K","L"].map(g => `1${g}`);

    // The remaining R32 matches that do NOT involve third-placed teams.
    // If your previous version already had the exact official pairings you wanted,
    // paste them here and you are done.
    //
    // Format: { home: "slotCode", away: "slotCode" }
    // Slot codes should be like: 1A, 2B, 3C, etc.
    const FIXED_MATCH_SLOTS = [
      // Placeholder defaults (edit if needed)
      { home: "1C", away: "2L" },
      { home: "1F", away: "2K" },
      { home: "1H", away: "2J" },
      { home: "1J", away: "2F" },
      { home: "2A", away: "2H" },
      { home: "2B", away: "2I" },
      { home: "2C", away: "2G" },
      { home: "2D", away: "2E" }
    ];

    // -----------------------------
    // STATE
    // -----------------------------

    let thirdMapping = null;

    const groupTableBody = document.querySelector("#groupTable tbody");
    const statusLine = document.getElementById("statusLine");
    const r32TableBody = document.querySelector("#r32Table tbody");
    const mappingDebug = document.getElementById("mappingDebug");

    // -----------------------------
    // UI BUILD
    // -----------------------------

    function buildGroupRows(){
      groupTableBody.innerHTML = "";
      for(const g of GROUPS){
        const tr = document.createElement("tr");

        const tdGroup = document.createElement("td");
        tdGroup.innerHTML = `<strong>${g}</strong>`;
        tr.appendChild(tdGroup);

        const td1 = document.createElement("td");
        td1.innerHTML = `<input class="team" id="t-1${g}" placeholder="Winner (1${g})" />`;
        tr.appendChild(td1);

        const td2 = document.createElement("td");
        td2.innerHTML = `<input class="team" id="t-2${g}" placeholder="Runner-up (2${g})" />`;
        tr.appendChild(td2);

        const td3 = document.createElement("td");
        td3.innerHTML = `<input class="team" id="t-3${g}" placeholder="Third (3${g})" />`;
        tr.appendChild(td3);

        const tdAdv = document.createElement("td");
        tdAdv.innerHTML = `
          <label class="third-toggle">
            <input type="checkbox" id="adv-${g}" />
            <span>Advance</span>
          </label>
        `;
        tr.appendChild(tdAdv);

        groupTableBody.appendChild(tr);
      }
    }

    buildGroupRows();

    // -----------------------------
    // HELPERS
    // -----------------------------

    function getInputValue(id){
      const el = document.getElementById(id);
      return (el?.value ?? "").trim();
    }

    function setInputValue(id, value){
      const el = document.getElementById(id);
      if(el) el.value = value;
    }

    function isThirdAdvanced(g){
      const el = document.getElementById(`adv-${g}`);
      return !!el?.checked;
    }

    function slotsFromInputs(){
      const slots = {};
      for(const g of GROUPS){
        slots[`1${g}`] = getInputValue(`t-1${g}`) || `1${g}`;
        slots[`2${g}`] = getInputValue(`t-2${g}`) || `2${g}`;
        slots[`3${g}`] = getInputValue(`t-3${g}`) || `3${g}`;
      }
      return slots;
    }

    function advancedThirdGroups(){
      return GROUPS.filter(g => isThirdAdvanced(g));
    }

    function keyFromThirdGroups(groups){
      return [...groups].sort().join("");
    }

    function resolveThirdAssignments(key){
      if(!thirdMapping) return null;
      const val = thirdMapping[key];

      if(!val) return null;

      // Support two formats:
      // 1) Object mapping: { "1A": "3E", ... }
      if(typeof val === "object" && !Array.isArray(val)){
        return { type: "object", data: val };
      }

      // 2) Array in the same order as THIRD_WINNERS_ORDER
      if(Array.isArray(val)){
        return { type: "array", data: val };
      }

      return null;
    }

    function buildThirdMatches(assignments){
      const matches = [];
      if(assignments.type === "object"){
        for(const w of THIRD_WINNERS_ORDER){
          const thirdSlot = assignments.data[w];
          matches.push({ home: w, away: thirdSlot });
        }
        return matches;
      }

      if(assignments.type === "array"){
        const arr = assignments.data;
        for(let i=0; i<THIRD_WINNERS_ORDER.length; i++){
          matches.push({ home: THIRD_WINNERS_ORDER[i], away: arr[i] });
        }
        return matches;
      }

      return matches;
    }

    function toDisplayName(slotCode, slotsMap){
      if(!slotCode) return "TBD";
      return slotsMap[slotCode] ?? slotCode;
    }

    function renderR32(matches, slotsMap){
      r32TableBody.innerHTML = "";

      if(!matches.length){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="3" class="small">No matches generated.</td>`;
        r32TableBody.appendChild(tr);
        return;
      }

      matches.forEach((m, idx) => {
        const tr = document.createElement("tr");

        const matchId = `R32-${String(idx+1).padStart(2,"0")}`;
        const homeName = toDisplayName(m.home, slotsMap);
        const awayName = toDisplayName(m.away, slotsMap);

        tr.innerHTML = `
          <td><strong>${matchId}</strong></td>
          <td>
            ${homeName}
            <span class="pill">${m.home ?? "—"}</span>
          </td>
          <td>
            ${awayName}
            <span class="pill">${m.away ?? "—"}</span>
          </td>
        `;
        r32TableBody.appendChild(tr);
      });
    }

    function setStatus(msg, type=""){
      if(type === "ok"){
        statusLine.innerHTML = `<span class="ok">${msg}</span>`;
      }else if(type === "warn"){
        statusLine.innerHTML = `<span class="warn">${msg}</span>`;
      }else{
        statusLine.textContent = msg;
      }
    }

    // -----------------------------
    // LOAD THIRD MAPPING JSON
    // -----------------------------

    async function loadThirdMapping(){
      try{
        const res = await fetch("./third-mapping.json", { cache: "no-store" });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        thirdMapping = data;

        const keys = Object.keys(thirdMapping || {});
        setStatus(`Third-place mapping loaded (${keys.length} combinations).`, "ok");
      }catch(err){
        thirdMapping = null;
        setStatus(
          "Could not load third-mapping.json. Make sure it sits next to index.html in the repo root.",
          "warn"
        );
      }
    }

    await loadThirdMapping();

    // -----------------------------
    // ACTIONS
    // -----------------------------

    function generateR32(){
      const slotsMap = slotsFromInputs();
      const thirdGroups = advancedThirdGroups();

      if(thirdGroups.length !== 8){
        setStatus(`Select exactly 8 third-placed groups to advance (you selected ${thirdGroups.length}).`, "warn");
        mappingDebug.textContent = "—";
        renderR32([], slotsMap);
        return;
      }

      const key = keyFromThirdGroups(thirdGroups);
      mappingDebug.textContent = `Third groups: [${thirdGroups.join(", ")}]\nKey: ${key}`;

      const assignments = resolveThirdAssignments(key);

      if(!assignments){
        setStatus(`No mapping found for key "${key}". Check your third-mapping.json.`, "warn");
        renderR32([], slotsMap);
        return;
      }

      const thirdMatches = buildThirdMatches(assignments);

      const allMatches = [
        ...thirdMatches,
        ...FIXED_MATCH_SLOTS
      ];

      setStatus(`R32 generated using key "${key}".`, "ok");
      renderR32(allMatches, slotsMap);
    }

    function clearAll(){
      for(const g of GROUPS){
        setInputValue(`t-1${g}`,"");
        setInputValue(`t-2${g}`,"");
        setInputValue(`t-3${g}`,"");
        const cb = document.getElementById(`adv-${g}`);
        if(cb) cb.checked = false;
      }
      mappingDebug.textContent = "—";
      r32TableBody.innerHTML = `<tr><td colspan="3" class="small">Generate to see matchups.</td></tr>`;
      setStatus(thirdMapping ? "Third-place mapping loaded." : "Mapping not loaded.", thirdMapping ? "ok" : "warn");
    }

    function fillDemo(){
      for(const g of GROUPS){
        setInputValue(`t-1${g}`, `Team ${g}1`);
        setInputValue(`t-2${g}`, `Team ${g}2`);
        setInputValue(`t-3${g}`, `Team ${g}3`);
      }

      // Pre-check a common demo combo: E F G H I J K L
      for(const g of GROUPS){
        const cb = document.getElementById(`adv-${g}`);
        if(cb) cb.checked = ["E","F","G","H","I","J","K","L"].includes(g);
      }

      setStatus("Demo data filled. Click Generate R32.", "ok");
    }

    // -----------------------------
    // WIRE EVENTS
    // -----------------------------

    document.getElementById("generateBtn").addEventListener("click", generateR32);
    document.getElementById("clearBtn").addEventListener("click", clearAll);
    document.getElementById("demoBtn").addEventListener("click", fillDemo);

  </script>
</body>
</html>
