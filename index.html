<!doctype html>
<html lang="en">
<head>
  <!-- =========================================
       HTML <head>
       - Metadata
       - Title
       - Viewport for mobile
       - CSS styles for theme + layout + drag UI
  ========================================== -->

  <meta charset="utf-8" />
  <title>Drag-Drop Starter (Mobile Safe)</title>

  <!-- Critical for mobile layout + correct scaling -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* =========================================
       CSS SECTION MAP
       1) Theme variables
       2) Global resets + body
       3) Layout containers (header/board/column)
       4) Dropzone styling (normal + "over")
       5) Card styling (including mobile drag fix)
       6) Dragging states (ghost + floating clone)
       7) Buttons + footer
    ========================================== */


    /* =========================================
       1) Theme variables (colors, sizes)
       - Easy customization point
       - Change these without touching logic
    ========================================== */
    :root{
      --bg:#0f1220;
      --panel:#151a2e;
      --panel-2:#111527;
      --text:#f5f7ff;
      --muted:#b9c0e6;
      --accent:#7aa2ff;
      --border:rgba(255,255,255,0.08);
      --radius:14px;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    /* =========================================
       2) Global resets
       - Consistent box sizing
    ========================================== */
    *{box-sizing:border-box}

    /* =========================================
       Body styling
       - Background ambience
       - Base typography
    ========================================== */
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 10% 10%, #1c2342 0%, var(--bg) 40%, #070912 100%);
      min-height:100vh;
    }

    /* =========================================
       3) Header layout
       - Title + hint + reset button
    ========================================== */
    header{
      padding: 18px 20px 0 20px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }
    header h1{
      font-size: 18px;
      font-weight: 650;
      margin:0;
      letter-spacing:0.2px;
    }
    header .hint{
      color:var(--muted);
      font-size: 12px;
    }

    /* =========================================
       3) Main board grid
       - 1 column on small screens
       - 3 columns on large screens
    ========================================== */
    .board{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      padding: 14px 16px 30px 16px;
    }

    @media (min-width: 900px){
      .board{
        grid-template-columns: 1fr 1fr 1fr;
        gap: 16px;
      }
    }

    /* =========================================
       3) Column container
       - Visual "panel" for each zone
    ========================================== */
    .column{
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: 180px;
      display:flex;
      flex-direction:column;
    }

    /* Column top header inside each panel */
    .column-header{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--border);
    }
    .column-title{
      font-size: 13px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      color: var(--muted);
    }
    .count{
      font-size: 11px;
      color: var(--muted);
      opacity: 0.9;
    }

    /* =========================================
       4) Dropzone
       - Container that holds cards
       - "over" class is applied during drag hover
    ========================================== */
    .dropzone{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      flex: 1;
      transition: background 120ms ease, outline 120ms ease;
    }

    /* Highlight state when pointer is over this zone */
    .dropzone.over{
      background: rgba(122,162,255,0.08);
      outline: 1px dashed rgba(122,162,255,0.5);
      outline-offset: -6px;
    }

    /* =========================================
       5) Card styling
       - Each draggable item
       - Most important mobile fix:
         touch-action: none;
         This stops the browser from treating
         finger drag as page scroll.
    ========================================== */
    .card{
      background: rgba(255,255,255,0.04);
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      cursor: grab;
      user-select: none;

      /* âœ… CRITICAL MOBILE FIX */
      touch-action: none;

      transition: transform 80ms ease, background 120ms ease, border-color 120ms ease;
    }
    .card:active{ cursor: grabbing; }

    .name{
      font-size: 14px;
      font-weight: 560;
      letter-spacing: 0.1px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .tag{
      font-size: 10px;
      color: var(--muted);
      border:1px solid var(--border);
      padding: 3px 6px;
      border-radius: 999px;
    }

    /* =========================================
       6) Dragging states
    ========================================== */

    /* Original card becomes faint while dragging */
    .dragging{
      opacity: 0.35;
    }

    /* Floating clone that follows your finger/mouse */
    .drag-clone{
      position: fixed;
      z-index: 9999;
      pointer-events: none;
      width: min(340px, 88vw);
      transform: translate(-50%, -50%);
      box-shadow: 0 18px 45px rgba(0,0,0,0.5);
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(8px);
    }

    /* =========================================
       7) Footer + button
    ========================================== */
    .footer{
      padding: 0 16px 24px 16px;
      color: var(--muted);
      font-size: 11px;
    }

    button.reset{
      background: rgba(122,162,255,0.12);
      color: var(--text);
      border: 1px solid rgba(122,162,255,0.35);
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 11px;
      cursor: pointer;
    }
    button.reset:hover{
      background: rgba(122,162,255,0.18);
    }
  </style>
</head>

<body>
  <!-- =========================================
       HTML BODY SECTION MAP
       1) Header (title + hint + reset)
       2) Board (3 columns)
          - Each column contains:
            - column header (title + count)
            - dropzone container
       3) Footer
  ========================================== -->

  <!-- 1) App header -->
  <header>
    <div>
      <h1>Mobile-Safe Drag & Drop Foundation</h1>
      <div class="hint">Pointer Events + touch-action:none + no scroll while dragging</div>
    </div>

    <!-- Reset button restores starter demo state -->
    <button class="reset" id="resetBtn">Reset Demo</button>
  </header>

  <!-- 2) Main board: contains all dropzones -->
  <main class="board" id="board">

    <!-- Column 1: Pool -->
    <section class="column">
      <div class="column-header">
        <div class="column-title">Pool</div>
        <div class="count" data-count-for="pool"></div>
      </div>
      <div class="dropzone" data-zone="pool"></div>
    </section>

    <!-- Column 2: Group A Slot 1 -->
    <section class="column">
      <div class="column-header">
        <div class="column-title">Group A (Slot 1)</div>
        <div class="count" data-count-for="a1"></div>
      </div>
      <div class="dropzone" data-zone="a1"></div>
    </section>

    <!-- Column 3: Group A Slot 2 -->
    <section class="column">
      <div class="column-header">
        <div class="column-title">Group A (Slot 2)</div>
        <div class="count" data-count-for="a2"></div>
      </div>
      <div class="dropzone" data-zone="a2"></div>
    </section>
  </main>

  <!-- 3) Simple footer note -->
  <div class="footer">
    Next step after this works flawlessly on your phone: replace demo structures with real World Cup groups.
  </div>

  <script>
    /* =========================================
       JAVASCRIPT SECTION MAP
       1) State model
       2) Render function
       3) State helpers
       4) Pointer-based drag engine
       5) Reset action
       6) Boot
    ========================================== */


    /* =========================================
       1) Minimal state
       - Each zone is an array of team objects
       - Later you will expand zones to Group A-L etc.
    ========================================== */
    const initialState = () => ({
      pool: [
        { id: "usa", name: "United States", tag: "Demo" },
        { id: "bra", name: "Brazil", tag: "Demo" },
        { id: "fra", name: "France", tag: "Demo" },
        { id: "jpn", name: "Japan", tag: "Demo" }
      ],
      a1: [],
      a2: []
    });

    let state = initialState();

    /* =========================================
       Zones registry
       - This list drives rendering + searches
       - When you add more groups,
         extend this array and state keys.
    ========================================== */
    const zones = ["pool", "a1", "a2"];


    /* =========================================
       2) Render
       - Clears each dropzone
       - Rebuilds cards from current state
       - Updates counts
       - Attaches drag listeners per card
    ========================================== */
    function render(){
      zones.forEach(zone => {
        const dz = document.querySelector(`.dropzone[data-zone="${zone}"]`);
        dz.innerHTML = "";

        state[zone].forEach(team => {
          const card = document.createElement("div");
          card.className = "card";

          /* Store metadata on the element itself */
          card.dataset.id = team.id;
          card.dataset.zone = zone;

          /* Card content */
          card.innerHTML = `
            <span class="name">${team.name}</span>
            <span class="tag">${team.tag ?? ""}</span>
          `;

          /* Attach pointer-based drag behavior */
          attachPointerDrag(card);

          dz.appendChild(card);
        });

        /* Update header counts */
        const countEl = document.querySelector(`[data-count-for="${zone}"]`);
        if(countEl) countEl.textContent = `${state[zone].length} item${state[zone].length !== 1 ? "s" : ""}`;
      });
    }


    /* =========================================
       3) State helpers
    ========================================== */

    /* Find the team in any zone */
    function findTeamAndZone(teamId){
      for(const z of zones){
        const idx = state[z].findIndex(t => t.id === teamId);
        if(idx !== -1) return { zone: z, index: idx, team: state[z][idx] };
      }
      return null;
    }

    /* Move a team from one zone to another */
    function moveTeam(teamId, toZone){
      const found = findTeamAndZone(teamId);
      if(!found) return;

      const { zone: fromZone, index, team } = found;

      /* Ignore if dropped into same zone */
      if(fromZone === toZone) return;

      /* Remove from old zone, push to new */
      state[fromZone].splice(index, 1);
      state[toZone].push(team);

      /* Re-render to reflect changes */
      render();
    }

    /* Determine which dropzone lies under x/y */
    function zoneFromPoint(x, y){
      const all = [...document.querySelectorAll(".dropzone")];
      return all.find(dz => {
        const r = dz.getBoundingClientRect();
        return x >= r.left && x <= r.right && y >= r.top && y <= r.bottom;
      });
    }


    /* =========================================
       4) Pointer-based drag engine
       Why pointer events?
       - Unifies mouse + touch + pen
       - More reliable than HTML5 drag on mobile
       Key mobile protections:
       - card { touch-action: none }
       - pointerdown/move: preventDefault()
       - setPointerCapture() keeps drag stable
    ========================================== */

    let dragging = null;

    function attachPointerDrag(card){
      /* Start drag */
      card.addEventListener("pointerdown", (e) => {
        /* Only allow left mouse button or touch */
        if(e.button !== undefined && e.button !== 0) return;

        /* Stop page scrolling / text selecting */
        e.preventDefault();

        const teamId = card.dataset.id;

        /* Create a clone that visually follows pointer */
        const rect = card.getBoundingClientRect();
        const clone = card.cloneNode(true);
        clone.classList.add("drag-clone");
        document.body.appendChild(clone);

        /* Fade the original card */
        card.classList.add("dragging");

        /* Store drag session data */
        dragging = {
          teamId,
          originCard: card,
          clone,
          pointerId: e.pointerId,

          /* Center-follow offset so clone feels natural */
          offsetX: e.clientX - (rect.left + rect.width/2),
          offsetY: e.clientY - (rect.top + rect.height/2),

          /* Track hover zone to update highlight */
          lastZoneEl: null
        };

        /* Ensures we keep receiving pointer events */
        card.setPointerCapture(e.pointerId);

        /* Place clone at start position */
        positionClone(e.clientX, e.clientY);
      });

      /* During drag */
      card.addEventListener("pointermove", (e) => {
        if(!dragging || dragging.pointerId !== e.pointerId) return;

        /* Prevent scroll on mobile */
        e.preventDefault();

        positionClone(e.clientX, e.clientY);

        /* Highlight zone under pointer */
        const zoneEl = zoneFromPoint(e.clientX, e.clientY);

        if(zoneEl !== dragging.lastZoneEl){
          document.querySelectorAll(".dropzone").forEach(z => z.classList.remove("over"));
          if(zoneEl) zoneEl.classList.add("over");
          dragging.lastZoneEl = zoneEl;
        }
      });

      /* End drag */
      card.addEventListener("pointerup", (e) => {
        if(!dragging || dragging.pointerId !== e.pointerId) return;
        e.preventDefault();
        finishDrag(e.clientX, e.clientY);
      });

      /* Cancel drag (system interruption) */
      card.addEventListener("pointercancel", (e) => {
        if(!dragging || dragging.pointerId !== e.pointerId) return;
        finishDrag(null, null, true);
      });
    }

    /* Position floating clone near pointer */
    function positionClone(x, y){
      if(!dragging) return;
      dragging.clone.style.left = `${x - dragging.offsetX}px`;
      dragging.clone.style.top  = `${y - dragging.offsetY}px`;
    }

    /* Finalize drag:
       - remove hover styles
       - remove clone
       - if over a zone, move team */
    function finishDrag(x, y, cancelled=false){
      const { teamId, originCard, clone } = dragging;

      /* Clear visual states */
      document.querySelectorAll(".dropzone").forEach(z => z.classList.remove("over"));
      originCard.classList.remove("dragging");
      clone.remove();

      /* Execute drop if valid */
      if(!cancelled && x !== null && y !== null){
        const zoneEl = zoneFromPoint(x, y);
        if(zoneEl){
          const toZone = zoneEl.dataset.zone;
          moveTeam(teamId, toZone);
        }
      }

      dragging = null;
    }


    /* =========================================
       5) Reset demo
       - Restores original starter content
    ========================================== */
    document.getElementById("resetBtn").addEventListener("click", () => {
      state = initialState();
      render();
    });


    /* =========================================
       6) Boot
       - First render when page loads
    ========================================== */
    render();

  </script>
</body>
</html>
